<script>

const listedPeople = [
  {
    "email": "Brian email",
    "id": 938705020378835700,
    "name": "Brian",
  },
  {
    "email": "Dana email",
    "id": 679486706697450400,
    "name": "Dana",
  },
  {
    "email": "Em email",
    "id": 223820751693978620,
    "name": "Em",
  },
  {
    "email": "Jack email",
    "id": 83417727648052880,
    "name": "Jack",
  },
  {
    "email": "Michael email",
    "id": 652899634236487300,
    "name": "Michael",
  },
  {
    "email": "Lauren email",
    "id": 900741110005811700,
    "name": "Lauren",
  },
];

console.log(listedPeople);

const listedInclusions = [
  {
    "from": 938705020378835700,
    "id": 56278601168576744,
    "to": 652899634236487300,
  },
  {
    "from": 900741110005811700,
    "id": 56278601168578354,
    "to": 679486706697450400,
  },
];

console.log(listedInclusions);

const listedExclusions = [
  {
    "from": 938705020378835700,
    "id": 158414670150343700,
    "to": 679486706697450400,
  },
  {
    "from": 679486706697450400,
    "id": 160007785937532830,
    "to": 938705020378835700,
  },
  {
    "from": 223820751693978620,
    "id": 145682715211924100,
    "to": 83417727648052880,
  },
  {
    "from": 83417727648052880,
    "id": 457513756470826050,
    "to": 223820751693978620,
  },
  {
    "from": 652899634236487300,
    "id": 278820521073866240,
    "to": 900741110005811700,
  },
  {
    "from": 900741110005811700,
    "id": 959698176989223700,
    "to": 652899634236487300,
  },
];

console.log(listedExclusions);

function randomize(arrayIn) {
    let arrayOut = [];
    for(let i in arrayIn) {
        let randomIndex = Math.floor(Math.random() * arrayIn.length);
        while(arrayOut.includes(arrayIn[randomIndex])) {
            randomIndex = Math.floor(Math.random() * arrayIn.length);
        }
        arrayOut[i] = arrayIn[randomIndex];
    }
    return arrayOut;
}

function randomizePeople(listedPeople) {
    var randomizedListedPeople = randomize(listedPeople);
    randomizedListedPeople = randomize(randomizedListedPeople);
    randomizedListedPeople = randomize(randomizedListedPeople);
    randomizedListedPeople = randomize(randomizedListedPeople);

    return randomizedListedPeople;
};

var randomizedListedPeople = randomizePeople(listedPeople)

console.log(randomizedListedPeople);

function get_vectors(randomizedListedPeople, listedInclusions, listedExclusions) {

  let vectors = {};

  for (listedInclusion of listedInclusions) {
    vectors[listedInclusion['from']] = listedInclusion['to'];
  }
  console.log(vectors);
  console.log('----');

  let excluded = false;
  let matched = false;
  let iterations = 0;
  let person2;
  let n = 0;

  for (let [i, person1] of Object.entries(randomizedListedPeople)) {

    matched = false;
    iterations = 0;

    if (!(person1['id'] in vectors)) {

      if (i == (randomizedListedPeople.length - 1)) {
        n = 0;
      } else {
        n = parseInt(i) + 1;
      }

      while (!(matched) && iterations<10) {

        if (iterations < (randomizedListedPeople.length * 2)) {
          excluded = false;
          person2 = randomizedListedPeople[n];

          if (person2 == person1) {

            if (n >= (randomizedListedPeople.length - 1)) {
              n = 0;
            } else {
              n++;
            }
            iterations++;

          } else if (person2['id'] in vectors) {

            if (n >= (randomizedListedPeople.length - 1)) {
              n = 0;
            } else {
              n++;
            }
            iterations++;

          } else {

            for (exclusion of Object.entries(listedExclusions)) {

              if (exclusion['from'] == person1['id'] && exclusion['to'] == person2['id']) {
                excluded = true;
                break;
              }

              if (excluded) {

                if (n >= (randomizedListedPeople.length - 1)) {
                  n = 0;
                } else {
                  n++;
                }
                iterations++;

              } else {

                vectors[listedInclusion['from']] = listedInclusion['to'];
                matched = true;

              }
            }
          }
        } else {

          randomizedListedPeople = randomizePeople(randomizedListedPeople);
          vectors = get_vectors(randomizedListedPeople, listedInclusions, listedExclusions);

        }
      }
    }
    console.log(vectors);
  }

  return vectors;

}

let vectors = get_vectors(randomizedListedPeople, listedInclusions, listedExclusions);

console.log(vectors);

</script>
